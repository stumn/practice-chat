<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <title>Socket.IO chat</title>
</head>

<body>
  <!-- メインのリストと、フォーム -->
  <main>
    <ul id="messages"></ul>
    <!-- ↓formタグのactionは送信先を指定 セキュリティとかの理由でactionの""は空白にする-->
    <form id="form" action="">
      <input id="nickname" name="name" placeholder="ニックネーム">
      <input id="input" autocomplete="off" placeholder="メッセージ" />
      <button>Send</button>
    </form>
  </main>
  <!-- javascript　ブラウザ側 -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    
    //フォーム系　取得 
    const form = document.getElementById('form');
    const nickname = document.getElementById('nickname');
    const input = document.getElementById('input');

    // １プロンプト　ログイン送信
    const name = prompt("名前を入力してください", "");    
    socket.emit('login', name);

    // メッセージリスト作成ファンクション
    function addMessage(msg){
      const item = document.createElement('li');
      item.textContent = msg;
      messages.appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    }

    // ２ログイン完了　いらっしゃい！
    socket.on('welcome', (welcome) => {
      addMessage(welcome);
    });

    // ３チャット送信
    form.addEventListener('submit', (event) => {
      event.preventDefault();
      if (nickname.value) {
        socket.emit('nickname', nickname.value);
      }
      if (input.value) {
        socket.emit('chat message', input.value);
        input.value = '';
      }
    });

    // チャット送信完了 ->みんなに表示
    socket.on('chatLogs', (logs) => {
      addMessage(logs);
    });

    // ディスコネクト
    socket.on('disconnection', (bye) => {
      addMessage(bye);
    });

  </script>
</body>

</html>